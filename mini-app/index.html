<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghost FluX Casino</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #fff;
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .neon-text {
            font-size: 28px;
            font-weight: bold;
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff, 0 0 30px #00ffff;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff; }
            to { text-shadow: 0 0 15px #00ffff, 0 0 30px #00ffff, 0 0 40px #00ffff; }
        }

        .balance-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #00ffff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        .balance-amount {
            font-size: 32px;
            font-weight: bold;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
        }

        .game-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 20px;
            margin-bottom: 15px;
            color: #ff00ff;
            text-shadow: 0 0 10px #ff00ff;
        }

        .game-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .game-btn {
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            border: none;
            border-radius: 10px;
            padding: 15px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
        }

        .game-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.8);
        }

        .game-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .bonus-btn {
            background: linear-gradient(45deg, #ff9900, #ffcc00);
            width: 100%;
        }

        .bonus-btn:disabled {
            background: linear-gradient(45deg, #666, #999);
        }

        .inventory-btn {
            background: linear-gradient(45deg, #00ff00, #00cc00);
            width: 100%;
        }

        .result-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .result-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            border: 2px solid #00ffff;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
        }

        .won-item {
            font-size: 48px;
            margin: 20px 0;
        }

        .won-text {
            font-size: 24px;
            color: #00ff00;
            margin-bottom: 20px;
        }

        .close-btn {
            background: #ff00ff;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .lightning {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            opacity: 0;
        }

        @keyframes lightning {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }

        .bonus-timer {
            font-size: 12px;
            color: #ff9900;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="neon-text">üëª Ghost FluX</h1>
            <p>–ö–∞–∑–∏–Ω–æ –ø–æ–¥–∞—Ä–∫–æ–≤</p>
        </div>

        <div class="balance-card">
            <h3>–í–∞—à –±–∞–ª–∞–Ω—Å</h3>
            <div class="balance-amount" id="balance">0 ‚≠ê</div>
        </div>

        <div class="game-section">
            <h3 class="section-title">üé∞ –ò–≥—Ä–æ–≤—ã–µ —Ä–µ–∂–∏–º—ã</h3>
            <div class="game-buttons">
                <button class="game-btn" onclick="openCase()">
                    üéÅ Gift Box<br>
                    <small>25 –∑–≤—ë–∑–¥</small>
                </button>
                <button class="game-btn" onclick="spinRoulette()">
                    üé° Roulette<br>
                    <small>50 –∑–≤—ë–∑–¥</small>
                </button>
            </div>
            
            <button class="game-btn bonus-btn" onclick="openBonus()" id="bonusBtn">
                üéØ –ë–æ–Ω—É—Å–Ω—ã–π –∫–µ–π—Å
                <div class="bonus-timer" id="bonusTimer"></div>
            </button>
        </div>

        <button class="game-btn inventory-btn" onclick="showInventory()">
            üì¶ –ú–æ–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
        </button>

        <div class="loading" id="loading">
            <p>–û—Ç–∫—Ä—ã–≤–∞–µ–º...</p>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -->
    <div class="result-modal" id="resultModal">
        <div class="result-content">
            <div class="won-item" id="wonItemEmoji">üéÅ</div>
            <div class="won-text" id="wonItemText">–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –ø–æ–¥–∞—Ä–æ–∫!</div>
            <button class="close-btn" onclick="closeResult()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        let userBalance = 0;
        let userId = null;
        let lastBonusTime = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        tg.expand();
        tg.ready();

        // –ü–æ–ª—É—á–∞–µ–º user_id –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL
        const urlParams = new URLSearchParams(window.location.search);
        userId = urlParams.get('startapp');

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        loadUserData();

        async function loadUserData() {
            try {
                const response = await fetch(`https://ghost-flux-casino-xxx.vercel.app/api/user/${userId}`);
                const userData = await response.json();
                userBalance = userData.balance || 0;
                document.getElementById('balance').textContent = userBalance + ' ‚≠ê';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–æ–Ω—É—Å–∞
                if (userData.last_bonus_claim) {
                    lastBonusTime = new Date(userData.last_bonus_claim);
                    updateBonusTimer();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        async function openCase() {
            if (userBalance < 25) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥!');
                return;
            }

            showLoading(true);
            
            try {
                const response = await fetch('https://ghost-flux-casino-xxx.vercel.app/api/open-case', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: userId
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    userBalance = result.newBalance;
                    document.getElementById('balance').textContent = userBalance + ' ‚≠ê';
                    showResult(result.wonItem);
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + result.error);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            } finally {
                showLoading(false);
            }
        }

        async function spinRoulette() {
            if (userBalance < 50) {
                alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥!');
                return;
            }

            showLoading(true);
            
            try {
                const response = await fetch('https://ghost-flux-casino-xxx.vercel.app/api/spin-roulette', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: userId
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    userBalance = result.newBalance;
                    document.getElementById('balance').textContent = userBalance + ' ‚≠ê';
                    showResult(result.wonItem);
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + result.error);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            } finally {
                showLoading(false);
            }
        }

        async function openBonus() {
            const bonusBtn = document.getElementById('bonusBtn');
            if (bonusBtn.disabled) {
                return;
            }

            showLoading(true);
            
            try {
                const response = await fetch('https://ghost-flux-casino-xxx.vercel.app/api/open-bonus', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: userId
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    userBalance = result.newBalance;
                    document.getElementById('balance').textContent = userBalance + ' ‚≠ê';
                    lastBonusTime = new Date();
                    updateBonusTimer();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±–æ–Ω—É—Å–∞
                    document.getElementById('wonItemEmoji').textContent = '‚≠ê';
                    document.getElementById('wonItemText').textContent = `–í—ã –ø–æ–ª—É—á–∏–ª–∏ ${result.starsWon} –∑–≤—ë–∑–¥ –∏–∑ –±–æ–Ω—É—Å–Ω–æ–≥–æ –∫–µ–π—Å–∞!`;
                    document.getElementById('resultModal').style.display = 'flex';
                    createLightningEffect();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + result.error);
                }
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
            } finally {
                showLoading(false);
            }
        }

        function showInventory() {
            alert('–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏');
        }

        function showResult(wonItem) {
            document.getElementById('wonItemEmoji').textContent = wonItem.emoji;
            document.getElementById('wonItemText').textContent = `–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${wonItem.name} (${wonItem.price} –∑–≤—ë–∑–¥)!`;
            document.getElementById('resultModal').style.display = 'flex';
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –º–æ–ª–Ω–∏–∏
            createLightningEffect();
        }

        function closeResult() {
            document.getElementById('resultModal').style.display = 'none';
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function createLightningEffect() {
            const lightning = document.createElement('div');
            lightning.className = 'lightning';
            lightning.style.background = 'linear-gradient(45deg, transparent, #00ffff, transparent)';
            lightning.style.animation = 'lightning 0.3s ease-in-out';
            
            document.body.appendChild(lightning);
            
            setTimeout(() => {
                lightning.remove();
            }, 300);
        }

        function updateBonusTimer() {
            const bonusBtn = document.getElementById('bonusBtn');
            const bonusTimer = document.getElementById('bonusTimer');
            
            if (!lastBonusTime) {
                bonusBtn.disabled = false;
                bonusTimer.textContent = '–î–æ—Å—Ç—É–ø–µ–Ω —Å–µ–π—á–∞—Å';
                return;
            }

            const now = new Date();
            const timeDiff = now - lastBonusTime;
            const hoursPassed = timeDiff / (1000 * 60 * 60);

            if (hoursPassed >= 24) {
                bonusBtn.disabled = false;
                bonusTimer.textContent = '–î–æ—Å—Ç—É–ø–µ–Ω —Å–µ–π—á–∞—Å';
            } else {
                bonusBtn.disabled = true;
                const hoursLeft = 24 - Math.floor(hoursPassed);
                const minutesLeft = 60 - Math.floor((hoursPassed % 1) * 60);
                bonusTimer.textContent = `–ß–µ—Ä–µ–∑ ${hoursLeft}—á ${minutesLeft}–º`;
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
        setInterval(updateBonusTimer, 60000);
    </script>
</body>
</html>
